<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FullTextSearch.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Phase_01_Full_Text_Search</a> &gt; <a href="index.source.html" class="el_package">full_text_search</a> &gt; <span class="el_source">FullTextSearch.java</span></div><h1>FullTextSearch.java</h1><pre class="source lang-java linenums">package full_text_search;

import file_reader.Document;
import logics.SetLogic;
import word_manipulation.normalization.Normalizer;
import word_manipulation.tokenization.Tokenizer;
import lombok.Builder;
import java.util.*;
import java.util.stream.Collectors;

public class FullTextSearch {

    private final ArrayList&lt;Document&gt; documents;

    private final InvertedIndex invertedIndex;

    private final Normalizer normalizer;

    private final Tokenizer tokenizer;

    private InputGroups inputGroups;

    private Set&lt;Integer&gt; resultSet;

    /**
     * Constructs of full text search.
     * @param normalizer   normalizer.
     * @param tokenizer   tokenizer.
     */
<span class="nc" id="L30">    @Builder</span>
<span class="nc" id="L31">    public FullTextSearch(Normalizer normalizer, Tokenizer tokenizer) {</span>
<span class="nc" id="L32">        this.normalizer = normalizer;</span>
<span class="nc" id="L33">        this.tokenizer = tokenizer;</span>
<span class="nc" id="L34">        documents = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L35">        invertedIndex = new InvertedIndex();</span>
<span class="nc" id="L36">    }</span>

    /**
     * Add data to inverted index.
     * @param document   the document to add.
     */
    public void addDocument(Document document) {
<span class="nc" id="L43">        int idx = documents.size();</span>
<span class="nc" id="L44">        documents.add(document);</span>
<span class="nc" id="L45">        HashMap&lt;String, Integer&gt; tokenizedWord = new HashMap&lt;&gt;();</span>
<span class="nc" id="L46">        tokenizer.tokenize(document.getContext()).forEach((key, value) -&gt; {</span>
<span class="nc" id="L47">            String word = normalizer.normalize(key);</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">            if(!tokenizedWord.containsKey(word)) {</span>
<span class="nc" id="L49">                tokenizedWord.put(word, 0);</span>
            }
<span class="nc" id="L51">            document.setWordCount(document.getWordCount() + value);</span>
<span class="nc" id="L52">            tokenizedWord.put(word, tokenizedWord.get(word) + value);</span>
<span class="nc" id="L53">        });</span>
<span class="nc" id="L54">        addWordsToInvertedIndex(tokenizedWord, idx, document);</span>
<span class="nc" id="L55">        invertedIndex.sortData(documents);</span>
<span class="nc" id="L56">    }</span>

    public void addWordsToInvertedIndex(HashMap&lt;String, Integer&gt; tokenizedWord, int idx, Document document) {
<span class="nc bnc" id="L59" title="All 2 branches missed.">        for (Map.Entry&lt;String, Integer&gt; entry : tokenizedWord.entrySet()) {</span>
<span class="nc" id="L60">            String key = entry.getKey();</span>
<span class="nc" id="L61">            Integer value = entry.getValue();</span>
<span class="nc" id="L62">            Occurrence occurrence = new Occurrence(idx);</span>
<span class="nc" id="L63">            occurrence.setWordCount(value);</span>
<span class="nc" id="L64">            occurrence.setIsInTitle(normalizer.normalize(document.getName()).contains(key));</span>
<span class="nc" id="L65">            invertedIndex.addData(occurrence, key);</span>
<span class="nc" id="L66">        }</span>
<span class="nc" id="L67">    }</span>

    /**
     * Search query.
     * @param searchInput   query.
     * @return name of documents that you request.
     * @throws Exception   if query is null or query just have stop words.
     */
    public List&lt;String&gt; search(String searchInput) throws Exception {
<span class="nc bnc" id="L76" title="All 2 branches missed.">        if(searchInput.strip().equals(&quot;&quot;))</span>
<span class="nc" id="L77">            throw new Exception(&quot;Please enter some words!&quot;);</span>

<span class="nc" id="L79">        inputGroups = new InputGroups(searchInput, normalizer);</span>

<span class="nc bnc" id="L81" title="All 2 branches missed.">        if(inputGroups.hasOnlyOneNormalWord())</span>
<span class="nc" id="L82">            return invertedIndex.getOccurrences(inputGroups.getIncludeWords().iterator().next())</span>
<span class="nc" id="L83">                    .stream()</span>
<span class="nc" id="L84">                    .map(x -&gt; documents.get(x.getDocumentIndex()).getName())</span>
<span class="nc" id="L85">                    .collect(Collectors.toList());</span>
        else {
<span class="nc" id="L87">            Set&lt;Integer&gt; resultSet = getSearchResult();</span>
<span class="nc" id="L88">            return resultSet.stream()</span>
<span class="nc" id="L89">                    .map(x -&gt; documents.get(x).getName())</span>
<span class="nc" id="L90">                    .collect(Collectors.toList());</span>
        }
    }

    /**
     * finds number of documents with calculate logic set.
     * @return number of documents.
     */
    private Set&lt;Integer&gt; getSearchResult() {
<span class="nc" id="L99">        resultSet = new HashSet&lt;&gt;();</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">        for (int i = 0; i &lt; documents.size(); i++) {</span>
<span class="nc" id="L101">            resultSet.add(i);</span>
        }

<span class="nc" id="L104">        checkIncludeWords();</span>
<span class="nc" id="L105">        checkExcludeWords();</span>
<span class="nc" id="L106">        checkOptionalWords();</span>

<span class="nc" id="L108">        return resultSet;</span>
    }

    /**
     * Removes any document in the result set that don't have the words that must be included.
     */
    private void checkIncludeWords() {
<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (!inputGroups.getIncludeWords().isEmpty()) {</span>
<span class="nc" id="L116">            ArrayList&lt;Set&lt;Integer&gt;&gt; normalWordsResultSets =</span>
<span class="nc" id="L117">                    invertedIndex.getDocumentSets(inputGroups.getIncludeWords());</span>
<span class="nc" id="L118">            normalWordsResultSets.add(resultSet);</span>
<span class="nc" id="L119">            resultSet = SetLogic.intersect(normalWordsResultSets);</span>
        }
<span class="nc" id="L121">    }</span>

    /**
     * Removes documents from result set if they have any words that must be excluded.
     */
    private void checkExcludeWords() {
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (inputGroups.getExcludeWords().size() &gt; 0) {</span>
<span class="nc" id="L128">            Set&lt;Integer&gt; minusWordsResultSet =</span>
<span class="nc" id="L129">                    SetLogic.union(invertedIndex.getDocumentSets(inputGroups.getExcludeWords()));</span>
<span class="nc" id="L130">            resultSet = SetLogic.subtract(resultSet, minusWordsResultSet);</span>
        }
<span class="nc" id="L132">    }</span>

    /**
     * Removes document from result set that don't either of the optional words.
     */
    private void checkOptionalWords() {
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (inputGroups.getOptionalWords().size() &gt; 0) {</span>
<span class="nc" id="L139">            Set&lt;Integer&gt; plusWordsResultSet =</span>
<span class="nc" id="L140">                    SetLogic.union(invertedIndex.getDocumentSets(inputGroups.getOptionalWords()));</span>
<span class="nc" id="L141">            resultSet = SetLogic.intersect(new ArrayList&lt;&gt;(Arrays.asList(resultSet, plusWordsResultSet)));</span>
        }
<span class="nc" id="L143">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>